---
# yaml-language-server: $schema=https://schema.blue-build.org/recipe-v1.json
modules:
  - type: files
    files:
      - source: nvidia/common
      - destination: /
  - type: script
    snippets:
      - "sed -i '0,/enabled=0/{s/enabled=0/enabled=1/}' /etc/yum.repos.d/eyecantcu-supergfxctl.repo"
      - "sed -i '0,/enabled=0/{s/enabled=0/enabled=1/}' /etc/yum.repos.d/negativo17-fedora-nvidia.repo"
      - "sed -i '0,/enabled=0/{s/enabled=0/enabled=1/}' /etc/yum.repos.d/nvidia-container-toolkit.repo"
  - type: dnf
    install:
      packages:
        - "libva-nvidia-driver"
        - "libnvidia-fbc"
        - "libnvidia-ml"
        - "libnvidia-ml.i686"
        - "mesa-vulkan-drivers.i686"
        - "nvidia-driver"
        - "nvidia-driver-cuda"
        - "nvidia-driver-cuda-libs"
        - "nvidia-driver-cuda-libs.i686"
        - "nvidia-driver-libs"
        - "nvidia-driver-libs.i686"
        - "nvidia-modprobe"
        - "nvidia-persistenced"
  - type: script
    snippets:
      - "ln -s /usr/lib/libnvidia-ml.so.1 /usr/lib/libnvidia-ml.so"
      - "rm -rf /tmp/* /var/*"
